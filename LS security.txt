28.03.2023

LS Security
----
 each caller will need credentials
 request data encryption
 ip whitelisting - single,block
 api-keys will be used.
 credentials table for storing api-keys
 how can developer be prevented from seeing api-key = shd be set in env variable, in cfg. developer shd not have access to it.
 api-keys shd be generated by risk on the admin portal
 LS will listen on https - (impl done but disabled, we might use nginx as a proxy to access ls so https will be configured on the nginx instead)
 LS processor nodes will listen on https port only
 
  
   LS api credentials 
   -----------------
   API key and API secret will be shared with client. Admin generates from interface
   client generates aes secret and aes iv(used for data encryption)
   client generates nonce. nonce shd be < 64 
		
   Security Headers
   X-API-Key  given to client
   X-Auth  RSA( sha512(apiSecret + nonce) . timestamp . aesSecret . aesIv )
   X-Nonce  nonce generated
		
CREATE TABLE `nonce` (
  `nonce` varchar(255) NOT NULL,
  `api_key` varchar(45) NOT NULL,
  `created` timestamp NULL DEFAULT current_timestamp(),
  UNIQUE KEY `unq` (`nonce`,`api_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
    
	delete expired nonces
 
Admin generate LS credentias
Table to store LS credentials
Table - id, key, secret, requester, app_name, app_description, status, approver, created

1. admin api to generate LytSwitch api credentials 
 new permission MANAGE API will be used to allow staff to be able to generate api credentials both for LS and for Merchants
 flow
   request body - requester, app name, app description
   generate api key, api secret, 
   set status to enabled(1)
   set approver email address
   insert into table - note encrypt the api key and secret bf inserting
        
2. manage ls api keys  - enable, disable
	enable/disable
 
 
 api credentials security consideration 
     1. add ip whitelisting 
	 2. service limit feature : ie api credentials can be tied to services it can caller
	 
IP Whitelisting
-----
1. All ips on the local subnet will be allowed. 
2. ip adresses can be added 	 
	 
	 ip address or subnet
	 -----
	 eg 192. 
	 
	 flow check if ip address is single or subnet
	 if single compare single
	 if subnet check if caller ipaddress is in subnet

NOTE: ip address addition or modification shd be effected in realtime. we dont want a situation when a merchant is added and we wait for a period to restart b4 it has taking effect	 

TODO
===
1. scheduler to be checking txn integrity(mac) and report fraudulent activity	 
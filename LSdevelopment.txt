bank api - crud\ ie add new bank to banks table
  
  
mac = hmac(amount+reference+debitAccount+creditAccount , secret);

LS Security
----
 each caller will need credentials
 request data encryption
 ip whitelisting - single,block
 api-keys will be used.
 credentials table for storing api-keys
 how can developer be prevented from seeing api-key = shd be set in env variable, in cfg. developer shd not have access to it.
 api-keys shd be generated by risk on the admin portal
 
create table ls_api_credentials
 api keys will be used
   X-API-Key = X-API-Key
   X-API-Secret = sha512(x-api-key.timestamp) . timestamp shd be 
   X-Nonce
   X-Timestamp
   
CREATE TABLE `nonce` (
  `nonce` varchar(255) NOT NULL,
  `api_key` varchar(45) NOT NULL,
  `created` timestamp NULL DEFAULT current_timestamp(),
  UNIQUE KEY `unq` (`nonce`,`api_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4
    
	delete expired nonces
 
Admin generate LS credentias
Table to store LS credentials
Table - id, key, secret, requester, app, status, approver, created


1,234,567,890,123,456

 
Fees 
------
fee are sent by caller 
fee services to be developed


microservices flow
-----
1. request from api gateway
2. retrieve merchant data (merchant code, accountId and add to the header/body)
3. call fee service if it applies and set the fee
4. validate request ie check params if request is correct
5. if Elevy applies, confirm the elevy amount using the reference passed. same reference was used by merchant to get the elevy
6. Generate LS request, encrypt data
7. LS calls requires authorisaction ie set auth header in request
8. call LS


Key discussion
*data encryption - AES CBC
*response json  { error, message, reference etc}


LS security  
---


transaction security
---
check digit - temporary block account if txn occurs within a period eg 1 sec interval and there are more than 1 request

implementation works/flow
--
db design and implementation ( 1 single table or two tables for insert request and insert response)
switch error codes
tables for duplex transactions
determination of json request - whether json object or json with nested objec
ls momo engine

04062023
1. ls txn tables - 2 tables to be used. 1.trans_req_log, transaction
2. 


error codes to use, error codes mapping table
see ecardb.e_reversal table
method markReversed(reference) = updates columns to reversal status. 


risk checks
-
check digit
log suspicious or profiled txns
block account number from receiving/sending transactions


-----------------------------------------------------------------------
cms
-----------------------------------------------------------------------
cms service for card creation, pin change, add account etc
cms also used to authenticate/authorize pin during transactions
cms also used to check customer profile during transactions. checks of daily, commulative, spending limits, account lock status, etc 

CMS Security
--
the card acccount needs to be encrypted cos if it is plain it can be changed. malicious user can change so that a particular account is debited

where will cms be located
----
cms will be co-hosted on the same server as LS. CMS will connect remotely to the ecardholder tables at the bank. Oga has suggested we host the ecardholder dbase at the bank for security reasons

cms hosting options
---
cohosting with ls and connecting to localdatabase
cohosting with ls and connecting to remote database
hosting remotely and connecting to the remote database

for best performance we have to cohost and also host the database locally

if hosting remotely and connecting to the remote database how do we optimise for performance



LS Documentation
PIN encryption, transport

How to handle two leg transactions (the tables needed). . LS transaction tables. LS W2B Processing
W2B notifications
LS request to banks clients, mobile money
LS Client sdk development
----


LS Future upgrades
Process ISO messaging


-----------------------------------------------------------------------
ls modules
-----------------------------------------------------------------------
key exchange
health check
fraud check
Auto refresh(no restart needed after changes) - internal cached data
reversal
momo engine - how to handle w2b or 2nd leg of momo debit txns
txn status
metrics/performance statistics
cms
bulkhead
custom apis

